<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="generator" content="Doxygen 1.9.1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MentOS: MentOS</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
            <table cellspacing="0" cellpadding="0">
                <tbody>
                    <tr style="height: 56px;">
                        <td id="projectalign" style="padding-left: 0.5em;">
                            <div id="projectname">MentOS
                                &#160;<span id="projectnumber">0.5.2</span>
                            </div>
                            <div id="projectbrief">The Mentoring Operating System</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MentOS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <a href="https://forthebadge.com"><img src="https://forthebadge.com/images/badges/built-with-love.svg" alt="forthebadge" style="pointer-events: none;" class="inline"/></a> <a href="https://forthebadge.com"><img src="https://forthebadge.com/images/badges/made-with-c.svg" alt="forthebadge" style="pointer-events: none;" class="inline"/></a> <a href="https://forthebadge.com"><img src="https://forthebadge.com/images/badges/for-you.svg" alt="forthebadge" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
1. What is MentOS</h1>
<p>MentOS (Mentoring Operating System) is an open source educational operating system. The goal of MentOS is to provide a project environment that is realistic enough to show how a real Operating System work, yet simple enough that students can understand and modify it in significant ways.</p>
<p>There are so many operating systems, why did we write MentOS? It is true, there are a lot of education operating system, BUT how many of them follow the guideline de fined by Linux?</p>
<p>MentOS aims to have the same Linux's data structures and algorithms. It has a well-documented source code, and you can compile it on your laptop in a few seconds!</p>
<p>If you are a beginner in Operating-System developing, perhaps MentOS is the right operating system to start with.</p>
<p>Parts of MentOS are inherited or inspired by a similar educational operating system called <a href="https://github.com/dreamos82/DreamOs">DreamOs</a> written by Ivan Gualandri.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
2. Implemented features</h1>
<p>Follows the list of implemented features:</p>
<p><b>Processes and Events</b></p><ul>
<li>[x] Memory protection (User vs Kernel);</li>
<li>[x] Processes;</li>
<li>[x] Scheduler (synchronous and asynchronous);</li>
<li>[x] Interrupts and Exceptions;</li>
<li>[x] Signals;</li>
<li>[x] Timers and RTC;</li>
<li>[x] Wait-queues;</li>
<li>[x] System Calls;</li>
<li>[ ] Multi-core;</li>
</ul>
<p><b>Memory</b></p><ul>
<li>[x] Paging;</li>
<li>[x] Buddy System;</li>
<li>[x] Slab Allocation;</li>
<li>[x] Zone Allocator;</li>
<li>[x] Cache Allocator;</li>
<li>[x] Heap;</li>
<li>[x] Virtual Addressing;</li>
</ul>
<p><b>Filesystem</b></p><ul>
<li>[x] Virtual Filesystem (VFS);</li>
<li>[x] Initramfs;</li>
<li>[x] EXT2;</li>
<li>[x] Procfs;</li>
</ul>
<p><b>Input/Output</b></p><ul>
<li>[x] Programmable Interrupt Controller (PIC) drivers;</li>
<li>[x] Keyboard drivers (IT/ENG layouts);</li>
<li>[x] Video drivers;</li>
<li>[ ] VGA drivers;</li>
</ul>
<p>I will try to keep it updated...</p>
<h1><a class="anchor" id="autotoc_md3"></a>
3. Prerequisites</h1>
<p>MentOS is compatible with the main <b>unix-based</b> operating systems. It has been tested with <em>Ubuntu</em>, <em>WSL1</em>, <em>WSL2</em>, and <em>MacOS</em>.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
3.1. Generic Prerequisites</h2>
<h3><a class="anchor" id="autotoc_md5"></a>
3.1.1. Compile</h3>
<p>For compiling the system:</p>
<ul>
<li>nasm</li>
<li>gcc</li>
<li>make</li>
<li>cmake</li>
<li>git</li>
<li>ccmake (suggested)</li>
<li>e2fsprogs (should be already installed)</li>
</ul>
<p>Under <b>MacOS</b>, for compiling, you have additional dependencies:</p>
<ul>
<li>i386-elf-binutils</li>
<li>i386-elf-gcc</li>
</ul>
<h3><a class="anchor" id="autotoc_md6"></a>
3.1.2. Execute</h3>
<p>To execute the operating system, you need to install:</p>
<ul>
<li>qemu-system-i386 (or qemu-system-x86)</li>
</ul>
<h3><a class="anchor" id="autotoc_md7"></a>
3.1.3. Debug</h3>
<p>For debugging we suggest using:</p>
<ul>
<li>gdb or cgdb</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
3.2. installation Prerequisites</h2>
<p>Under <b>Ubuntu</b>, you can type the following commands:</p>
<div class="fragment"><div class="line">sudo apt-get update &amp;&amp; sudo apt-get upgrade -y</div>
<div class="line">sudo apt-get install -y build-essential git cmake qemu-system-x86 nasm e2fsprogs</div>
<div class="line">sudo apt-get install -y gdb cgdb</div>
</div><!-- fragment --><p> Note: Older versions might have <code>qemu-system-i386</code> instead of <code>qemu-system-x86</code>.</p>
<p>Under <b>MacOS</b> you also need to install the i386-elf cross-compiler. The simplest installation method is through Homebrew package manager. Install <a href="https://brew.sh/index_it">Homebrew</a> if you don't already have it, and then type the following commands:</p>
<div class="fragment"><div class="line">brew update &amp;&amp; brew upgrade</div>
<div class="line">brew install i386-elf-binutils i386-elf-gcc git cmake qemu nasm e2fsprogs</div>
<div class="line">brew install gdb cgdb #&lt;- for debug only</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
4. Compiling MentOS and generating the EXT2 filesystem</h1>
<p>Compile MentOS with:</p>
<div class="fragment"><div class="line">cd &lt;clone_directory&gt;</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>Then, generate the EXT2 filesystem with:</p>
<div class="fragment"><div class="line">make filesystem</div>
</div><!-- fragment --><p> you just need to generate the filesystem once. If you change a <code>program</code> you need to re-generate the entire filesystem with <code>make filesystem</code>, but this will override any changes you made to the files inside the <code>rootfs.img</code>. In the future I will find a way to update just the <code>/usr/bin</code> directory and the programs.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
5. Running MentOS</h1>
<p>Boot MentOS with qemu:</p>
<div class="fragment"><div class="line">make qemu</div>
</div><!-- fragment --><p>To login, use one of the usernames listed in <code>files/etc/passwd</code>.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
6. Kernel logging</h1>
<p>The kernel provides ways of printing logging messages <em>from</em> inside the kernel code <em>to</em> the bash where you executed the <code>make qemu</code>.</p>
<p>These <em>logging</em> functions are: </p><div class="fragment"><div class="line"> {C++}</div>
<div class="line">#define pr_emerg(...)</div>
<div class="line">#define pr_alert(...)</div>
<div class="line">#define pr_crit(...)</div>
<div class="line">#define pr_err(...)</div>
<div class="line">#define pr_warning(...)</div>
<div class="line">#define pr_notice(...)</div>
<div class="line">#define pr_info(...)</div>
<div class="line">#define pr_debug(...)</div>
<div class="line">#define pr_default(...)</div>
</div><!-- fragment --><p>You use them like you would use a <code>printf</code>: </p><div class="fragment"><div class="line">{C++}</div>
<div class="line">   if (fd &lt; 0) {</div>
<div class="line">       pr_err(&quot;Failed to open file &#39;%s&#39;, received file descriptor %d.\n&quot;, filename, fd);</div>
<div class="line">       return 1;</div>
<div class="line">   }</div>
</div><!-- fragment --><p>By default only message that goes from <code>pr_notice</code> included down to <code>pr_emerg</code> are displayed.</p>
<p>Each logging function (they are actually macros) is a wrapper that automatically sets the desired <b>log level</b>. Each log level is identified by a number, and declared as follows: </p><div class="fragment"><div class="line"> {C++}</div>
<div class="line">#define LOGLEVEL_DEFAULT (-1) ///&lt; default-level messages.</div>
<div class="line">#define LOGLEVEL_EMERG   0    ///&lt; system is unusable.</div>
<div class="line">#define LOGLEVEL_ALERT   1    ///&lt; action must be taken immediately.</div>
<div class="line">#define LOGLEVEL_CRIT    2    ///&lt; critical conditions.</div>
<div class="line">#define LOGLEVEL_ERR     3    ///&lt; error conditions.</div>
<div class="line">#define LOGLEVEL_WARNING 4    ///&lt; warning conditions.</div>
<div class="line">#define LOGLEVEL_NOTICE  5    ///&lt; normal but significant condition.</div>
<div class="line">#define LOGLEVEL_INFO    6    ///&lt; informational.</div>
<div class="line">#define LOGLEVEL_DEBUG   7    ///&lt; debug-level messages.</div>
</div><!-- fragment --><p>You can change the logging level by including the following lines at the beginning of your source code: </p><div class="fragment"><div class="line"> {C++}</div>
<div class="line">// Include the kernel log levels.</div>
<div class="line">#include &quot;sys/kernel_levels.h&quot;</div>
<div class="line">/// Change the header.</div>
<div class="line">#define __DEBUG_HEADER__ &quot;[ATA   ]&quot;</div>
<div class="line">/// Set the log level.</div>
<div class="line">#define __DEBUG_LEVEL__ LOGLEVEL_INFO</div>
</div><!-- fragment --><p> This example sets the <code>__DEBUG_LEVEL__</code>, so that all the messages from <code>INFO</code> and below are shown. While <code>__DEBUG_HEADER__</code> is just a string that is automatically prepended to your message, helping you identifying from which code the message is coming from.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
7. Change the scheduling algorithm</h1>
<p>MentOS supports scheduling algorithms for aperiodic:</p>
<ul>
<li>Round-Robin (RR)</li>
<li>Highest Priority</li>
<li>Completely Fair Scheduling (CFS)</li>
<li>Aperiodic Earliest Deadline First (AEDF)</li>
</ul>
<p>It also supports periodic algorithms:</p>
<ul>
<li>Earliest Deadline First (EDF)</li>
<li>Rate Monotonic (RM)</li>
</ul>
<p>If you want to change the scheduling algorithm, to Round-Robin (RR) for instance:</p>
<div class="fragment"><div class="line">cd build</div>
<div class="line">cmake -DSCHEDULER_TYPE=SCHEDULER_RR ..</div>
<div class="line">make</div>
<div class="line">make qemu</div>
</div><!-- fragment --><p>or you can activate one of the others:</p>
<div class="fragment"><div class="line"># Highest Priority</div>
<div class="line">cmake -DSCHEDULER_TYPE=SCHEDULER_PRIORITY ..</div>
<div class="line"># Completely Fair Scheduling (CFS)</div>
<div class="line">cmake -DSCHEDULER_TYPE=SCHEDULER_CFS      ..</div>
<div class="line"># Earliest Deadline First (EDF)</div>
<div class="line">cmake -DSCHEDULER_TYPE=SCHEDULER_EDF      ..</div>
<div class="line"># Rate Monotonic (RM)</div>
<div class="line">cmake -DSCHEDULER_TYPE=SCHEDULER_RM       ..</div>
<div class="line"># Aperiodic Earliest Deadline First (AEDF)</div>
<div class="line">cmake -DSCHEDULER_TYPE=SCHEDULER_AEDF     ..</div>
</div><!-- fragment --><p>Otherwise you can use <code>ccmake</code>:</p>
<div class="fragment"><div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">ccmake ..</div>
</div><!-- fragment --><p>Now you should see something like this:</p>
<div class="fragment"><div class="line">BUILD_DOCUMENTATION              ON</div>
<div class="line">CMAKE_BUILD_TYPE</div>
<div class="line">CMAKE_INSTALL_PREFIX             /usr/local</div>
<div class="line">DEBUGGING_TYPE                   DEBUG_STDIO</div>
<div class="line">ENABLE_BUDDY_SYSTEM              OFF</div>
<div class="line">SCHEDULER_TYPE                   SCHEDULER_RR</div>
</div><!-- fragment --><p>Select SCHEDULER_TYPE, and type Enter to scroll the three available algorithms (SCHEDULER_RR, SCHEDULER_PRIORITY, SCHEDULER_CFS, SCHEDULER_EDF, SCHEDULER_RM, SCHEDULER_AEDF). Afterwards, you need to</p>
<div class="fragment"><div class="line">&lt;press c&gt;</div>
<div class="line">&lt;press g&gt;</div>
<div class="line">make</div>
<div class="line">make qemu</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
8. Use Debugger</h1>
<p>If you want to use GDB to debug MentOS, first you need to compile everything:</p>
<div class="fragment"><div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>Then, you need to generate a file called <code>.gdbinit</code> placed inside the <code>build</code> directory, which will tell <b>gdb</b> which <em>object</em> file he needs to read in order to allow proper debugging. To generate the file, just execute: </p><div class="fragment"><div class="line">make gdbinit</div>
</div><!-- fragment --><p>Finally, you run qemu in debugging mode with: </p><div class="fragment"><div class="line">make qemu-gdb</div>
</div><!-- fragment --><p>If you did everything correctly, you should see an empty QEMU window. Basically, QEMU is waiting for you to connect <em>remotely</em> with gdb. Anyway, running <code>make qemu-gdb</code> will make your current shell busy, you cannot call <code>gdb</code> in it. You need to open a new shell inside the <code>build</code> folder and do a: </p><div class="fragment"><div class="line">cgdb -q -iex &#39;add-auto-load-safe-path .&#39;</div>
</div><!-- fragment --><p>Now you will have:</p><ol type="1">
<li>the QEMU window waiting for you,</li>
<li>the shell where you ran <code>make qemu-gdb</code> also waiting for you,</li>
<li>the debugger that loaded a series of symbol files and the location of their <code>.text</code> section.</li>
</ol>
<p>By default I placed a breakpoint at the begginning of 1) the bootloader, 2) the <code>kmain</code> function of the kernel.</p>
<p>So, when gdb starts you need to first give a continue: </p><div class="fragment"><div class="line">(gdb) continue</div>
</div><!-- fragment --><p>This will make the kernel run, and stop at the first breakpoint which is inside the <em>bootloader</em>: </p><div class="fragment"><div class="line">Breakpoint 1, boot_main (...) at .../mentos/src/boot.c:220</div>
<div class="line">220     {</div>
</div><!-- fragment --><p>giving a second <code>continue</code> will get you to the start of the operating system:</p>
<p>This will make the kernel run, and stop at the first breakpoint which is inside the <em>bootloader</em>: </p><div class="fragment"><div class="line">Breakpoint 2, kmain (...) at .../mentos/src/kernel.c:95</div>
<div class="line">95      {</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14"></a>
9. Contributors</h1>
<p>Project Manager:</p>
<ul>
<li><a href="https://github.com/Galfurian">Enrico Fraccaroli</a></li>
</ul>
<p>Developers:</p><ul>
<li><a href="https://github.com/alessandroDanese88">Alessandro Danese</a>, <a href="https://github.com/luigicapogrosso">Luigi Capogrosso</a>, <a href="https://github.com/mircodemarchi">Mirco De Marchi</a><ul>
<li>Protection ring</li>
<li>libc</li>
</ul>
</li>
<li>Andrea Cracco<ul>
<li>Buddy System, Heap, Paging, Slab, Caching, Zone</li>
<li>Process Image, ELF</li>
<li>VFS: procfs</li>
<li>Bootloader</li>
</ul>
</li>
<li>Linda Sacchetto, Marco Berti<ul>
<li>Real time scheduler</li>
</ul>
</li>
<li>Daniele Nicoletti, Filippo Ziche<ul>
<li>Real time scheduler (Asynchronous EDF)</li>
<li>Soft IRQs</li>
<li>Timer</li>
<li>Signals </li>
</ul>
</li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
        <!-- HTML footer for doxygen 1.8.16-->
        <!-- start footer part -->
        <div class="footer">
            <hr class="footer" />
            <ul class="footer-info">
                <li class="footer-info-lastmode">
                    This page was last modified on Fri Dec 9 2022 11:03:31.
                </li>
                <li class="footer-info-copyright">
                    MentOs © 2014–2022 the MentOs-Team, and numerous contributors.<br>
                    It is available for use and modification under the&#160;
                    <a href="md_LICENSE.html">MIT License</a>.<br>
                </li>
            </ul>
            <hr class="footer" />
            <address class="footer">
                Generated by&#160;
                <a href="http://www.doxygen.org/index.html">
                    <img class="footer" src="doxygen.png" alt="doxygen" />
                </a> 1.9.1
            </address>
        </div>
    </body>
</html>